import{j as e}from"./vendor-ui-osK9DzZo.js";import{r as s}from"./vendor-react-BFBzZzDX.js";import{C as a,b as t,c as i,d as r,a as l}from"./card-BvxQYS25.js";import{c as n,I as o,B as c}from"./quiz-intro-BplHFC3N.js";import{B as d}from"./badge-nN955xTj.js";import{Y as m,Z as x,_ as u,$ as p,a0 as j,a1 as h,a2 as g,a3 as f}from"./ui-components-DOTaqTTj.js";import{X as N}from"./index-CJWu_7KR.js";import{S as v}from"./scroll-area-BJ6_kEXu.js";import{T as y,a as w,b,c as z,d as q,e as A}from"./table-BWDfpsjA.js";import{S as C,U as _,M as T}from"./user-C8chJEVF.js";import{D}from"./AnalyticsPage-DgmSPEBk.js";import{S as E}from"./shopping-cart-C_pC-GrH.js";import{E as S}from"./eye-JFQXPBVm.js";import{C as k}from"./clock-Cv8mVDTq.js";import{C as F}from"./circle-check-big-C6ALa2yZ.js";import{P as I}from"./play-f7MnLFDt.js";import"./analytics-nnBgKcWZ.js";import"./select-BrLU5xrt.js";import"./index-BzWa2atf.js";import"./chevron-down-CzVrvDXY.js";import"./check-Y0sHiPmm.js";import"./chevron-right-BdPOXfGU.js";import"./trash-2-BqfjP_O-.js";import"./tabs-3EbfV8Cc.js";import"./useLoadingState-B9k6n92w.js";import"./use-mobile-Bm5YhP0o.js";const R=m,L=x,Q=u,U=s.forwardRef((({className:s,...a},t)=>e.jsx(f,{ref:t,className:n("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})));U.displayName=f.displayName;const B=s.forwardRef((({className:s,children:a,...t},i)=>e.jsxs(Q,{children:[e.jsx(U,{}),e.jsxs(p,{ref:i,className:n("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[a,e.jsxs(j,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));B.displayName=p.displayName;const H=({className:s,...a})=>e.jsx("div",{className:n("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});H.displayName="DialogHeader";const M=({className:s,...a})=>e.jsx("div",{className:n("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});M.displayName="DialogFooter";const P=s.forwardRef((({className:s,...a},t)=>e.jsx(h,{ref:t,className:n("text-lg font-semibold leading-none tracking-tight",s),...a})));P.displayName=h.displayName;const O=s.forwardRef((({className:s,...a},t)=>e.jsx(g,{ref:t,className:n("text-sm text-muted-foreground",s),...a})));O.displayName=g.displayName;const $=({analyticsData:n,loading:m})=>{const[x,u]=s.useState(""),[p,j]=s.useState(null),[h,g]=s.useState(null),[f,N]=s.useState([]),Q=s.useMemo((()=>{if(!(null==n?void 0:n.events))return[];const e=new Map;return n.events.forEach((s=>{const a=s.sessionId||s.userEmail||"unknown";e.has(a)||e.set(a,{id:a,name:s.userName||"Anônimo",email:s.userEmail||s.email||"N/A",startTime:null,lastActivity:null,completed:!1,totalQuestions:0});const t=e.get(a);if(s.timestamp){const e=new Date(s.timestamp);(!t.startTime||e<t.startTime)&&(t.startTime=e),(!t.lastActivity||e>t.lastActivity)&&(t.lastActivity=e)}"quiz_complete"===s.type&&(t.completed=!0,t.completeTime=new Date(s.timestamp)),"quiz_answer"===s.type&&t.totalQuestions++})),Array.from(e.values()).filter((e=>e.name.toLowerCase().includes(x.toLowerCase())||e.email.toLowerCase().includes(x.toLowerCase()))).sort(((e,s)=>e.lastActivity?s.lastActivity?s.lastActivity.getTime()-e.lastActivity.getTime():-1:1))}),[n,x]),U=e=>e?new Intl.DateTimeFormat("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(e):"N/A",$=s=>{switch(s){case"quiz_start":return e.jsx(I,{className:"h-4 w-4 text-blue-500"});case"quiz_complete":return e.jsx(F,{className:"h-4 w-4 text-green-500"});case"quiz_answer":return e.jsx(k,{className:"h-4 w-4 text-purple-500"});case"result_view":return e.jsx(S,{className:"h-4 w-4 text-indigo-500"});case"lead_generated":return e.jsx(T,{className:"h-4 w-4 text-yellow-500"});case"sale":return e.jsx(E,{className:"h-4 w-4 text-green-500"});default:return e.jsx(_,{className:"h-4 w-4 text-gray-500"})}},V=Q;return e.jsx("div",{className:"space-y-6",children:e.jsxs(a,{children:[e.jsx(t,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Usuários do Quiz"}),e.jsx(r,{className:"mt-1",children:"Informações detalhadas sobre cada usuário que iniciou o quiz"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsx(o,{className:"w-[250px]",placeholder:"Buscar por nome ou email...",value:x,onChange:e=>u(e.target.value)})]})]})}),e.jsx(l,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(y,{children:[e.jsx(w,{children:e.jsxs(b,{children:[e.jsx(z,{children:"Usuário"}),e.jsx(z,{children:"Email"}),e.jsx(z,{children:"Início"}),e.jsx(z,{children:"Última atividade"}),e.jsx(z,{children:"Status"}),e.jsx(z,{children:"Perguntas"}),e.jsx(z,{className:"text-right",children:"Ações"})]})}),e.jsx(q,{children:V.length>0?V.map((s=>e.jsxs(b,{children:[e.jsx(A,{className:"font-medium",children:s.name}),e.jsx(A,{children:s.email}),e.jsx(A,{children:U(s.startTime)}),e.jsx(A,{children:U(s.lastActivity)}),e.jsx(A,{children:s.completed?e.jsx(d,{className:"bg-green-500 text-white",children:"Concluído"}):e.jsx(d,{variant:"outline",className:"border-yellow-500 text-yellow-500",children:"Em progresso"})}),e.jsx(A,{className:"text-center",children:s.totalQuestions}),e.jsx(A,{className:"text-right",children:e.jsxs(R,{children:[e.jsx(L,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>(e=>{if(j(e),!(null==n?void 0:n.events))return void N([]);const s=n.events.filter((s=>s.sessionId===e||s.userEmail===e));N(s)})(s.id),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Detalhes"]})}),e.jsxs(B,{className:"sm:max-w-[800px]",children:[e.jsxs(H,{children:[e.jsx(P,{children:"Detalhes do Usuário"}),e.jsxs(O,{children:["Histórico completo de atividades do usuário: ",null==h?void 0:h.name]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Nome"}),e.jsx("p",{className:"text-base",children:null==h?void 0:h.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsx("p",{className:"text-base",children:null==h?void 0:h.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Início"}),e.jsx("p",{className:"text-base",children:U(null==h?void 0:h.startTime)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Conclusão"}),e.jsx("p",{className:"text-base",children:U(null==h?void 0:h.completeTime)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Perguntas Respondidas"}),e.jsx("p",{className:"text-base",children:null==h?void 0:h.totalQuestions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("p",{className:"text-base",children:(null==h?void 0:h.completed)?e.jsx(d,{className:"bg-green-500 text-white",children:"Concluído"}):e.jsx(d,{variant:"outline",className:"border-yellow-500 text-yellow-500",children:"Em progresso"})})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Histórico de Eventos"}),e.jsx(v,{className:"h-[300px]",children:e.jsxs("div",{className:"space-y-4",children:[f.map(((s,a)=>{var t;return e.jsxs("div",{className:"flex items-start gap-3 pb-3 border-b border-gray-100",children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:$(s.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"quiz_answer"===s.type?e.jsxs(e.Fragment,{children:["Respondeu à questão ",s.questionIndex+1]}):"quiz_start"===s.type?e.jsx(e.Fragment,{children:"Iniciou o quiz"}):"quiz_complete"===s.type?e.jsx(e.Fragment,{children:"Completou o quiz"}):"result_view"===s.type?e.jsxs(e.Fragment,{children:["Visualizou o resultado: ",s.resultType]}):"lead_generated"===s.type?e.jsxs(e.Fragment,{children:["Lead gerado: ",s.email]}):"sale"===s.type?e.jsxs(e.Fragment,{children:["Realizou uma compra no valor de R$ ",s.value]}):e.jsxs(e.Fragment,{children:["Evento: ",s.type]})}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.timestamp).toLocaleString()}),"quiz_answer"===s.type&&e.jsx("div",{className:"mt-1 text-xs text-gray-600",children:e.jsxs("p",{children:["Opções selecionadas: ",(null==(t=s.selectedOptions)?void 0:t.join(", "))||"N/A"]})})]})]},a)})),0===f.length&&e.jsx("p",{className:"text-sm text-gray-500",children:"Nenhum evento encontrado para este usuário."})]})})]}),e.jsx(M,{children:e.jsxs(c,{variant:"outline",onClick:()=>{},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Exportar Dados do Usuário"]})})]})]})})]},s.id))):e.jsx(b,{children:e.jsx(A,{colSpan:7,className:"text-center py-6 text-muted-foreground",children:x?"Nenhum usuário encontrado para esta busca.":"Nenhum usuário encontrado."})})})]})})})]})})};export{$ as UsersTab,$ as default};
