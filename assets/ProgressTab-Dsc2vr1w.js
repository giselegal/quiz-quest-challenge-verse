import{j as e}from"./vendor-ui-osK9DzZo.js";import{c as s}from"./vendor-react-BFBzZzDX.js";import{C as r,b as t,c as a,d as o,a as i}from"./card-BvxQYS25.js";import{T as n,a as d,b as l,c,d as m,e as x}from"./table-BWDfpsjA.js";import{G as p,C as j}from"./GridLayout-YBScUK24.js";import{P as h}from"./progress-BvtZe0GK.js";import{g as u}from"./AnalyticsPage-DgmSPEBk.js";import{B as f,C as N,X as b,Y as g,T as k,a as y,b as v}from"./BarChart-S_RUlykW.js";import{L as q,a as F}from"./LineChart-CoJs4nag.js";import"./quiz-intro-BplHFC3N.js";import"./ui-components-DOTaqTTj.js";import"./analytics-nnBgKcWZ.js";import"./check-Y0sHiPmm.js";import"./index-CJWu_7KR.js";import"./chevron-right-BdPOXfGU.js";import"./select-BrLU5xrt.js";import"./index-BzWa2atf.js";import"./chevron-down-CzVrvDXY.js";import"./trash-2-BqfjP_O-.js";import"./tabs-3EbfV8Cc.js";import"./useLoadingState-B9k6n92w.js";import"./use-mobile-Bm5YhP0o.js";const U=({analyticsData:U,loading:w})=>{const S=s.useMemo((()=>(null==U?void 0:U.events)?u(U.events):[]),[U]),R=s.useMemo((()=>!S||S.length<2?[]:S.map(((e,s)=>{s>0&&S[s-1];const r=s<S.length-1?S[s+1]:null,t=r?((e.uniqueUsers-r.uniqueUsers)/e.uniqueUsers*100).toFixed(1):"0.0",a=S[0]?(e.uniqueUsers/S[0].uniqueUsers*100).toFixed(1):"100.0";return{...e,dropoffRate:parseFloat(t),retentionFromStart:parseFloat(a)}}))),[S]),C={uniqueUsers:{label:"Usuários",theme:{light:"#8B5CF6",dark:"#A78BFA"}},retentionFromStart:{label:"Retenção",theme:{light:"#10b981",dark:"#34d399"}}},L=(e,s)=>`hsl(${260-e/Math.max(1,s-1)*100}, 70%, 60%)`,z=s=>{var r;if(!s.active||!(null==(r=s.payload)?void 0:r[0]))return null;const t=s.payload[0].payload;return e.jsxs("div",{className:"bg-white p-1.5 border border-gray-100 shadow-lg rounded-md",children:[e.jsxs("p",{className:"text-[7px] font-medium mb-0.5",children:["Questão ",t.questionId]}),e.jsxs("p",{className:"text-[7px] font-semibold",children:[t.uniqueUsers," usuários"]}),e.jsxs("p",{className:"text-[6px] text-gray-500 mt-0.5",children:[t.retentionFromStart,"% retenção total"]}),t.dropoffRate>0&&e.jsxs("p",{className:"text-[6px] text-rose-500 mt-0.5",children:[t.dropoffRate,"% abandonaram aqui"]})]})};return w?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando dados de progresso..."})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(p,{columns:2,gap:"md",children:[e.jsxs(r,{className:"border border-border/40 shadow-sm",children:[e.jsxs(t,{className:"pb-1.5",children:[e.jsx(a,{children:"Progresso por Questão"}),e.jsx(o,{className:"text-xs",children:"Usuários que alcançam cada pergunta"})]}),e.jsx(i,{className:"pt-1 px-2",children:e.jsx("div",{className:"h-[55px]",children:e.jsx(j,{config:C,children:e.jsxs(f,{data:S,margin:{top:5,right:5,left:0,bottom:0},children:[e.jsx(N,{strokeDasharray:"3 3",stroke:"#e0e0e0",vertical:!1}),e.jsx(b,{dataKey:"questionId",stroke:"#888888",tick:{fill:"#888888",fontSize:7},tickLine:{stroke:"#e0e0e0"}}),e.jsx(g,{stroke:"#888888",tick:{fill:"#888888",fontSize:7},tickLine:{stroke:"#e0e0e0"}}),e.jsx(k,{content:z}),e.jsx(y,{dataKey:"uniqueUsers",name:"Usuários",radius:[2,2,0,0],animationDuration:1200,animationEasing:"ease-out",children:S.map(((s,r)=>e.jsx(v,{fill:L(r,S.length)},`cell-${r}`)))})]})})})})]}),e.jsxs(r,{className:"border border-border/40 shadow-sm",children:[e.jsxs(t,{className:"pb-1.5",children:[e.jsx(a,{children:"Retenção do Funil"}),e.jsx(o,{className:"text-xs",children:"Acompanhamento da retenção por etapa"})]}),e.jsx(i,{className:"pt-1 px-2",children:e.jsx("div",{className:"h-[55px]",children:e.jsx(j,{config:C,children:e.jsxs(q,{data:R,margin:{top:5,right:5,left:0,bottom:0},children:[e.jsx(N,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),e.jsx(b,{dataKey:"questionId",stroke:"#888888",tick:{fill:"#888888",fontSize:7},tickLine:{stroke:"#e0e0e0"}}),e.jsx(g,{stroke:"#888888",tick:{fill:"#888888",fontSize:7},tickLine:{stroke:"#e0e0e0"}}),e.jsx(k,{content:z}),e.jsx(F,{type:"monotone",dataKey:"retentionFromStart",stroke:"#10b981",strokeWidth:1.5,dot:{r:1.5,strokeWidth:1},activeDot:{r:3,strokeWidth:0,fill:"#10b981"}})]})})})})]})]}),e.jsxs(r,{className:"border border-border/40 shadow-sm",children:[e.jsxs(t,{className:"pb-1.5",children:[e.jsx(a,{children:"Funil de Questões"}),e.jsx(o,{className:"text-xs",children:"Taxas de queda por etapa do quiz"})]}),e.jsx(i,{className:"pt-1.5",children:e.jsx("div",{className:"rounded-md border border-border/40 overflow-x-auto",children:e.jsxs(n,{children:[e.jsx(d,{children:e.jsxs(l,{children:[e.jsx(c,{className:"w-[80px]",children:"Questão"}),e.jsx(c,{className:"w-[80px]",children:"Usuários"}),e.jsx(c,{className:"w-[90px]",children:"Respostas"}),e.jsx(c,{children:"Taxa de Retenção"}),e.jsx(c,{children:"Abandono"})]})}),e.jsxs(m,{children:[R.map(((s,r)=>e.jsxs(l,{children:[e.jsxs(x,{className:"font-medium py-1.5 text-xs",children:["Q",r+1]}),e.jsx(x,{className:"py-1.5 text-xs",children:s.uniqueUsers}),e.jsx(x,{className:"py-1.5 text-xs",children:s.totalAnswers}),e.jsx(x,{className:"py-1.5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{value:s.retentionFromStart,className:"h-1.5 w-[40px]",indicatorClassName:`bg-[${L(r,R.length)}]`}),e.jsxs("span",{className:"text-xs",children:[s.retentionFromStart,"%"]})]})}),e.jsx(x,{className:"py-1.5 text-xs",children:s.dropoffRate>0?e.jsxs("span",{className:"text-rose-500",children:[s.dropoffRate,"%"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})]},s.questionId))),0===R.length&&e.jsx(l,{children:e.jsx(x,{colSpan:5,className:"text-center py-3 text-muted-foreground text-sm",children:"Nenhum dado de progresso disponível."})})]})]})})})]})]})};export{U as ProgressTab};
