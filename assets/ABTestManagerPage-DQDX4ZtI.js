import{j as e}from"./vendor-ui-osK9DzZo.js";import{u as s,r as t}from"./vendor-react-BFBzZzDX.js";import{B as a,I as i}from"./quiz-intro-BplHFC3N.js";import{T as r,a as n,b as l}from"./tabs-3EbfV8Cc.js";import{C as c,a as d}from"./card-BvxQYS25.js";import{L as o,S as m}from"./switch-jkdF1Dr4.js";import{S as x}from"./separator-CqVUG3bj.js";import{c as u}from"./index-CJWu_7KR.js";import{A as h}from"./arrow-left-P0C0AO9x.js";import{P as v,G as j,C as f,a as g,E as p}from"./plus-CjD2aSDE.js";import{S as N}from"./save-cbzEs7G3.js";import{C as b}from"./copy-BTKakseY.js";import{T as w}from"./trash-2-BqfjP_O-.js";import{S as y}from"./square-pen-Bgy9sLbV.js";import{C}from"./chart-no-axes-column-increasing-DMxzHA-v.js";import"./ui-components-DOTaqTTj.js";import"./index-BzWa2atf.js";import"./analytics-nnBgKcWZ.js";const D=()=>{const D=s(),{toast:S}=u(),[P,A]=t.useState([]),[k,I]=t.useState(null),[_,T]=t.useState("active"),[$,V]=t.useState(!1),[O,R]=t.useState(!1),[B,E]=t.useState(null);t.useEffect((()=>{z()}),[]);const z=()=>{try{const e=localStorage.getItem("ab_tests");if(e){const s=JSON.parse(e);A(s),s.length>0&&I(s[0])}}catch(e){S({title:"Erro ao carregar testes",description:"Não foi possível carregar os testes A/B salvos.",variant:"destructive"})}},U=e=>{try{localStorage.setItem("ab_tests",JSON.stringify(e)),A(e),S({title:"Testes salvos",description:"Os testes A/B foram salvos com sucesso."})}catch(s){S({title:"Erro ao salvar testes",description:"Não foi possível salvar os testes A/B.",variant:"destructive"})}},q=()=>{const e={id:`test_${Date.now()}`,name:"Novo Teste A/B",type:"result",isActive:!0,startDate:(new Date).toISOString(),variations:[{id:`var_${Date.now()}_a`,name:"Variação A (Original)",trafficPercentage:50,content:{}},{id:`var_${Date.now()}_b`,name:"Variação B",trafficPercentage:50,content:{}}]},s=[...P,e];U(s),I(e),E(e),V(!0),R(!0)},J=(e,s,t)=>{if(B){const a=B.variations.map((a=>a.id===e?{...a,[s]:t}:a));E({...B,variations:a})}},L=(e,s,t)=>{if(B){const a=B.variations.map((a=>a.id===e?{...a,content:{...a.content||{},[s]:t}}:a));E({...B,variations:a})}},M=P.filter((e=>"active"===_?e.isActive:!e.isActive)),G=(e,s)=>{try{const t=`ab_test_${e}_visitor_count_${s}`,a=localStorage.getItem(t),i=a?parseInt(a,10):0,r=`ab_test_${e}_${s}_conversions`,n=localStorage.getItem(r),l=n?parseInt(n,10):0;if(0===i)return"0%";return`${(l/i*100).toFixed(2)}%`}catch(t){return"N/A"}};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>D("/admin"),children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Voltar"]}),e.jsx("h1",{className:"text-2xl font-semibold",children:"Gerenciador de Testes A/B"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(c,{className:"mb-4",children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Testes"}),e.jsxs(a,{onClick:q,size:"sm",variant:"outline",children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"Novo Teste"]})]}),e.jsx(r,{defaultValue:"active",value:_,onValueChange:e=>T(e),className:"w-full",children:e.jsxs(n,{className:"w-full mb-4",children:[e.jsx(l,{value:"active",className:"flex-1",children:"Ativos"}),e.jsx(l,{value:"archived",className:"flex-1",children:"Arquivados"})]})}),0===M.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:["Nenhum teste ","active"===_?"ativo":"arquivado"," encontrado."]}):e.jsx("ul",{className:"space-y-2",children:M.map((s=>e.jsxs("li",{className:`\n                        p-3 rounded-md cursor-pointer hover:bg-muted transition-colors\n                        ${(null==k?void 0:k.id)===s.id?"bg-muted border-l-4 border-primary":""}\n                      `,onClick:()=>I(s),children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"result"===s.type?"Página de Resultados":"Página de Vendas"})]},s.id)))})]})})}),e.jsx("div",{className:"md:col-span-3",children:k?e.jsx(c,{children:e.jsx(d,{className:"p-6",children:$?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"space-y-1 flex-1",children:e.jsx(i,{value:(null==B?void 0:B.name)||"",onChange:e=>E((s=>s?{...s,name:e.target.value}:null)),className:"text-xl font-medium border-none bg-transparent focus-visible:ring-0 p-0 h-auto"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",onClick:()=>{if(V(!1),R(!1),O&&B){const e=P.filter((e=>e.id!==B.id));U(e),I(e.length>0?e[0]:null)}},children:"Cancelar"}),e.jsxs(a,{onClick:()=>{if(B){const e=P.map((e=>e.id===B.id?B:e));U(e),I(B),V(!1),R(!1)}},children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Salvar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Tipo de Teste"}),e.jsxs("select",{value:(null==B?void 0:B.type)||"result",onChange:e=>E((s=>s?{...s,type:e.target.value}:null)),className:"w-full mt-1 p-2 border rounded-md",children:[e.jsx("option",{value:"result",children:"Página de Resultados"}),e.jsx("option",{value:"sales",children:"Página de Vendas"})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Data de Início"}),e.jsx(i,{type:"date",value:(null==B?void 0:B.startDate)?new Date(B.startDate).toISOString().split("T")[0]:"",onChange:e=>E((s=>s?{...s,startDate:new Date(e.target.value).toISOString()}:null)),className:"mt-1"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Status"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(m,{checked:(null==B?void 0:B.isActive)||!1,onCheckedChange:e=>E((s=>s?{...s,isActive:e}:null))}),e.jsx(o,{children:(null==B?void 0:B.isActive)?"Ativo":"Inativo"})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Data de Término"}),e.jsx(i,{type:"date",value:(null==B?void 0:B.endDate)?new Date(B.endDate).toISOString().split("T")[0]:"",onChange:e=>{const s=e.target.value;E((e=>e?{...e,endDate:s?new Date(s).toISOString():void 0}:null))},className:"mt-1"})]})]})]}),e.jsx(x,{className:"my-6"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Variações"}),e.jsxs(a,{size:"sm",variant:"outline",onClick:()=>{if(B){const e={id:`var_${Date.now()}`,name:`Variação ${String.fromCharCode(65+B.variations.length)}`,trafficPercentage:0,content:{}},s=[...B.variations,e],t=Math.floor(100/s.length),a=s.map(((e,a)=>{if(a===s.length-1){const t=s.slice(0,-1).reduce(((e,s)=>e+(s.trafficPercentage||0)),0);return{...e,trafficPercentage:100-t}}return{...e,trafficPercentage:t}}));E({...B,variations:a})}},children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"Adicionar Variação"]})]}),e.jsx("div",{className:"space-y-4",children:null==B?void 0:B.variations.map((s=>{var t,r,n,l,d,m,x;return e.jsxs(c,{className:"p-4 border",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Nome da Variação"}),e.jsx(i,{value:s.name,onChange:e=>J(s.id,"name",e.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Domínio (opcional)"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(j,{className:"h-4 w-4 mr-2 text-muted-foreground"}),e.jsx(i,{value:s.domain||"",onChange:e=>J(s.id,"domain",e.target.value),placeholder:"ex: variacao-a.meudominio.com.br"})]})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Distribuição de Tráfego (%)"}),e.jsx(i,{type:"number",min:"0",max:"100",value:s.trafficPercentage||0,onChange:e=>J(s.id,"trafficPercentage",parseInt(e.target.value,10)),className:"mt-1"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{children:"URL de Checkout (para variação de teste)"}),e.jsx(i,{value:(null==(t=s.content)?void 0:t.checkoutUrl)||"",onChange:e=>L(s.id,"checkoutUrl",e.target.value),placeholder:"https://checkout.exemplo.com/seu-produto",className:"mt-1"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(o,{children:"Informações de Preço (para variação de teste)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-2",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-xs text-muted-foreground",children:"Preço Regular"}),e.jsx(i,{value:(null==(n=null==(r=s.content)?void 0:r.pricing)?void 0:n.regularPrice)||"",onChange:e=>{var t;const a={...(null==(t=s.content)?void 0:t.pricing)||{},regularPrice:e.target.value};L(s.id,"pricing",a)},placeholder:"R$ 175,00",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-xs text-muted-foreground",children:"Preço Atual"}),e.jsx(i,{value:(null==(d=null==(l=s.content)?void 0:l.pricing)?void 0:d.currentPrice)||"",onChange:e=>{var t;const a={...(null==(t=s.content)?void 0:t.pricing)||{},currentPrice:e.target.value};L(s.id,"pricing",a)},placeholder:"R$ 39,00",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-xs text-muted-foreground",children:"Informação de Parcelamento"}),e.jsx(i,{value:(null==(x=null==(m=s.content)?void 0:m.pricing)?void 0:x.installments)||"",onChange:e=>{var t;const a={...(null==(t=s.content)?void 0:t.pricing)||{},installments:e.target.value};L(s.id,"pricing",a)},placeholder:"4X de R$ 10,86",className:"mt-1"})]})]})]}),e.jsxs("div",{className:"flex justify-end mt-4 space-x-2",children:[e.jsxs(a,{size:"sm",variant:"outline",onClick:()=>(e=>{if(B){const s=B.variations.find((s=>s.id===e));if(!s)return;const t={...JSON.parse(JSON.stringify(s)),id:`var_${Date.now()}`,name:`${s.name} (cópia)`,trafficPercentage:0},a=[...B.variations,t],i=Math.floor(100/a.length),r=a.map(((e,s)=>{if(s===a.length-1){const s=a.slice(0,-1).reduce(((e,s)=>e+(s.trafficPercentage||0)),0);return{...e,trafficPercentage:100-s}}return{...e,trafficPercentage:i}}));E({...B,variations:r})}})(s.id),children:[e.jsx(b,{className:"h-4 w-4 mr-1"}),"Duplicar"]}),e.jsxs(a,{size:"sm",variant:"destructive",onClick:()=>(e=>{if(B){if(B.variations.length<=2)return void S({title:"Operação não permitida",description:"Um teste A/B precisa ter pelo menos duas variações.",variant:"destructive"});const s=B.variations.filter((s=>s.id!==e)),t=Math.floor(100/s.length),a=s.map(((e,a)=>{if(a===s.length-1){const t=s.slice(0,-1).reduce(((e,s)=>e+(s.trafficPercentage||0)),0);return{...e,trafficPercentage:100-t}}return{...e,trafficPercentage:t}}));E({...B,variations:a})}})(s.id),disabled:B.variations.length<=2,children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),"Excluir"]})]})]},s.id)}))})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:k.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"result"===k.type?"Página de Resultados":"Página de Vendas"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{checked:k.isActive,onCheckedChange:e=>((e,s)=>{const t=P.map((t=>t.id===e?{...t,isActive:s}:t));U(t),k&&k.id===e&&I({...k,isActive:s})})(k.id,e)}),e.jsx(o,{children:k.isActive?"Ativo":"Inativo"})]}),e.jsxs(a,{variant:"outline",onClick:()=>{k&&(E({...k}),V(!0))},children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(a,{variant:"destructive",onClick:()=>(e=>{if(window.confirm("Tem certeza que deseja excluir este teste? Esta ação não pode ser desfeita.")){const s=P.filter((s=>s.id!==e));U(s),k&&k.id===e&&I(s.length>0?s[0]:null)}})(k.id),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Data de Início"}),e.jsx("p",{children:new Date(k.startDate).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Data de Término"}),e.jsx("p",{children:k.endDate?new Date(k.endDate).toLocaleDateString():"Não definida"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(k.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:k.isActive?"Ativo":"Inativo"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Performance"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Variações"}),e.jsx("p",{className:"text-2xl font-semibold",children:k.variations.length})]}),e.jsx(C,{className:"h-8 w-8 text-muted-foreground opacity-50"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Dias Ativos"}),e.jsx("p",{className:"text-2xl font-semibold",children:Math.ceil(((new Date).getTime()-new Date(k.startDate).getTime())/864e5)})]}),e.jsx(f,{className:"h-8 w-8 text-muted-foreground opacity-50"})]})}),e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Distribuição"}),e.jsxs("p",{className:"text-2xl font-semibold",children:[k.variations.map((e=>e.trafficPercentage||0)).reduce(((e,s)=>e+s),0),"%"]})]}),e.jsx(g,{className:"h-8 w-8 text-muted-foreground opacity-50"})]})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Variações"}),e.jsx("div",{className:"space-y-4",children:k.variations.map((s=>{var t,a;return e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between md:items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(C,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[s.trafficPercentage||0,"% do tráfego"]})]}),s.domain&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:s.domain})]})]})]}),e.jsxs("div",{className:"mt-2 md:mt-0 flex flex-wrap gap-2",children:[e.jsxs("div",{className:"bg-blue-50 text-blue-700 px-2.5 py-0.5 rounded-full text-xs",children:["CR: ",G(k.id,s.id)]}),(null==(t=s.content)?void 0:t.checkoutUrl)&&e.jsxs("a",{href:null==(a=s.content)?void 0:a.checkoutUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-xs text-blue-600 hover:underline",children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),"Abrir checkout"]})]})]})},s.id)}))})]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-64 bg-muted rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-muted-foreground mb-2",children:"Nenhum teste selecionado"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Selecione um teste existente ou crie um novo para começar."}),e.jsxs(a,{onClick:q,children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Criar Novo Teste"]})]})})})]})]})};export{D as default};
