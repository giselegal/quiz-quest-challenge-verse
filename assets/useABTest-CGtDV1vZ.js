import{r as t}from"./vendor-react-BFBzZzDX.js";const e=e=>{const[a,o]=t.useState(!0),[n,r]=t.useState(null),[i,s]=t.useState(null);t.useEffect((()=>{(async()=>{try{o(!0);const t=localStorage.getItem("ab_tests");if(!t)return void o(!1);const a=JSON.parse(t).filter((t=>t.isActive&&t.type===e&&new Date(t.startDate)<=new Date&&(!t.endDate||new Date(t.endDate)>=new Date)));if(0===a.length)return void o(!1);const n=a[0];s(n);const i=window.location.hostname,c=n.variations.find((t=>t.domain&&i.includes(t.domain)));if(c)return r(c),void o(!1);const l=localStorage.getItem(`ab_test_${n.id}_visitor_id`);let d;l?d=parseInt(l,10):(d=Math.floor(100*Math.random()),localStorage.setItem(`ab_test_${n.id}_visitor_id`,d.toString()));let g=0;for(const e of n.variations)if(g+=e.trafficPercentage||0,d<g){r(e);break}o(!1)}catch(t){o(!1)}})()}),[e]);return{isLoading:a,currentVariation:n,activeTest:i,registerConversion:()=>{if(i&&n)try{const t=`ab_test_${i.id}_${n.id}_conversions`,e=localStorage.getItem(t),a=e?parseInt(e,10)+1:1;localStorage.setItem(t,a.toString());const o=`ab_test_${i.id}_${n.id}_conversion_timestamps`,r=localStorage.getItem(o),s=r?JSON.parse(r):[];s.push((new Date).toISOString()),localStorage.setItem(o,JSON.stringify(s))}catch(t){}}}};export{e as u};
